{"dependencies":[{"name":"../gamification/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":55},"end":{"line":2,"column":99,"index":154}}],"key":"kS+dQODfMADUn5Es/Mb8ksF0WwM=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.buildCompactSummary = buildCompactSummary;\n  var _events = require(_dependencyMap[0], \"../gamification/events\");\n  function avg(xs) {\n    return xs.length ? xs.reduce((a, b) => a + b, 0) / xs.length : 0;\n  }\n  function buildCompactSummary(state) {\n    const days = Object.values(state.days || {}).sort((a, b) => a.date.localeCompare(b.date));\n    const last14 = days.slice(-14);\n    const last7 = days.slice(-7);\n    const waterAvg = avg(last14.map(d => d.drinks?.water ?? 0));\n    const coffeeAvg = avg(last14.map(d => d.drinks?.coffee ?? 0));\n    const pillAdh = last7.length ? last7.filter(d => d.pills?.morning && d.pills?.evening).length / last7.length : 0;\n    const weights = days.filter(d => typeof d.weight === 'number');\n    let weightTrend = 0;\n    let weightLast = undefined;\n    if (weights.length >= 3) {\n      const first = weights[0].weight;\n      const last = weights[weights.length - 1].weight;\n      weightLast = last;\n      weightTrend = (last - first) / Math.max(1, weights.length - 1);\n    }\n    // weekly event progress (current week)\n    const week = (0, _events.getWeekRange)(new Date());\n    const evt = (0, _events.getCurrentWeeklyEvent)(week.start);\n    const {\n      percent\n    } = (0, _events.computeEventProgress)(week.dayKeys, state, evt);\n    return {\n      lang: state.language,\n      water_avg14: Number(waterAvg.toFixed(2)),\n      coffee_avg14: Number(coffeeAvg.toFixed(2)),\n      pill_adherence7: Number((pillAdh * 100).toFixed(0)),\n      weight_last: typeof weightLast === 'number' ? Number(weightLast.toFixed(1)) : null,\n      weight_trend_per_day: Number(weightTrend.toFixed(3)),\n      weekly_event: {\n        id: evt.id,\n        title: evt.title(state.language),\n        progress: percent\n      }\n    };\n  }\n});","lineCount":46,"map":[[6,2,2,0],[6,6,2,0,"_events"],[6,13,2,0],[6,16,2,0,"require"],[6,23,2,0],[6,24,2,0,"_dependencyMap"],[6,38,2,0],[7,2,4,0],[7,11,4,9,"avg"],[7,14,4,12,"avg"],[7,15,4,13,"xs"],[7,17,4,25],[7,19,4,27],[8,4,4,29],[8,11,4,36,"xs"],[8,13,4,38],[8,14,4,39,"length"],[8,20,4,45],[8,23,4,48,"xs"],[8,25,4,50],[8,26,4,51,"reduce"],[8,32,4,57],[8,33,4,58],[8,34,4,59,"a"],[8,35,4,60],[8,37,4,61,"b"],[8,38,4,62],[8,43,4,65,"a"],[8,44,4,66],[8,47,4,67,"b"],[8,48,4,68],[8,50,4,69],[8,51,4,70],[8,52,4,71],[8,55,4,72,"xs"],[8,57,4,74],[8,58,4,75,"length"],[8,64,4,81],[8,67,4,84],[8,68,4,85],[9,2,4,87],[10,2,6,7],[10,11,6,16,"buildCompactSummary"],[10,30,6,35,"buildCompactSummary"],[10,31,6,36,"state"],[10,36,6,84],[10,38,6,86],[11,4,7,2],[11,10,7,8,"days"],[11,14,7,12],[11,17,7,15,"Object"],[11,23,7,21],[11,24,7,22,"values"],[11,30,7,28],[11,31,7,29,"state"],[11,36,7,34],[11,37,7,35,"days"],[11,41,7,39],[11,45,7,41],[11,46,7,42],[11,47,7,43],[11,48,7,44],[11,49,7,45,"sort"],[11,53,7,49],[11,54,7,50],[11,55,7,51,"a"],[11,56,7,60],[11,58,7,61,"b"],[11,59,7,70],[11,64,7,73,"a"],[11,65,7,74],[11,66,7,75,"date"],[11,70,7,79],[11,71,7,80,"localeCompare"],[11,84,7,93],[11,85,7,94,"b"],[11,86,7,95],[11,87,7,96,"date"],[11,91,7,100],[11,92,7,101],[11,93,7,102],[12,4,8,2],[12,10,8,8,"last14"],[12,16,8,14],[12,19,8,17,"days"],[12,23,8,21],[12,24,8,22,"slice"],[12,29,8,27],[12,30,8,28],[12,31,8,29],[12,33,8,31],[12,34,8,32],[13,4,9,2],[13,10,9,8,"last7"],[13,15,9,13],[13,18,9,16,"days"],[13,22,9,20],[13,23,9,21,"slice"],[13,28,9,26],[13,29,9,27],[13,30,9,28],[13,31,9,29],[13,32,9,30],[14,4,10,2],[14,10,10,8,"waterAvg"],[14,18,10,16],[14,21,10,19,"avg"],[14,24,10,22],[14,25,10,23,"last14"],[14,31,10,29],[14,32,10,30,"map"],[14,35,10,33],[14,36,10,34,"d"],[14,37,10,35],[14,41,10,37,"d"],[14,42,10,38],[14,43,10,39,"drinks"],[14,49,10,45],[14,51,10,47,"water"],[14,56,10,52],[14,60,10,54],[14,61,10,55],[14,62,10,56],[14,63,10,57],[15,4,11,2],[15,10,11,8,"coffeeAvg"],[15,19,11,17],[15,22,11,20,"avg"],[15,25,11,23],[15,26,11,24,"last14"],[15,32,11,30],[15,33,11,31,"map"],[15,36,11,34],[15,37,11,35,"d"],[15,38,11,36],[15,42,11,38,"d"],[15,43,11,39],[15,44,11,40,"drinks"],[15,50,11,46],[15,52,11,48,"coffee"],[15,58,11,54],[15,62,11,56],[15,63,11,57],[15,64,11,58],[15,65,11,59],[16,4,12,2],[16,10,12,8,"pillAdh"],[16,17,12,15],[16,20,12,18,"last7"],[16,25,12,23],[16,26,12,24,"length"],[16,32,12,30],[16,35,12,34,"last7"],[16,40,12,39],[16,41,12,40,"filter"],[16,47,12,46],[16,48,12,47,"d"],[16,49,12,48],[16,53,12,50,"d"],[16,54,12,51],[16,55,12,52,"pills"],[16,60,12,57],[16,62,12,59,"morning"],[16,69,12,66],[16,73,12,70,"d"],[16,74,12,71],[16,75,12,72,"pills"],[16,80,12,77],[16,82,12,79,"evening"],[16,89,12,86],[16,90,12,87],[16,91,12,88,"length"],[16,97,12,94],[16,100,12,95,"last7"],[16,105,12,100],[16,106,12,101,"length"],[16,112,12,107],[16,115,12,111],[16,116,12,112],[17,4,13,2],[17,10,13,8,"weights"],[17,17,13,15],[17,20,13,18,"days"],[17,24,13,22],[17,25,13,23,"filter"],[17,31,13,29],[17,32,13,30,"d"],[17,33,13,31],[17,37,13,33],[17,44,13,40,"d"],[17,45,13,41],[17,46,13,42,"weight"],[17,52,13,48],[17,57,13,51],[17,65,13,59],[17,66,13,60],[18,4,14,2],[18,8,14,6,"weightTrend"],[18,19,14,17],[18,22,14,20],[18,23,14,21],[19,4,14,23],[19,8,14,27,"weightLast"],[19,18,14,57],[19,21,14,60,"undefined"],[19,30,14,69],[20,4,15,2],[20,8,15,6,"weights"],[20,15,15,13],[20,16,15,14,"length"],[20,22,15,20],[20,26,15,22],[20,27,15,23],[20,29,15,25],[21,6,16,4],[21,12,16,10,"first"],[21,17,16,15],[21,20,16,18,"weights"],[21,27,16,25],[21,28,16,26],[21,29,16,27],[21,30,16,28],[21,31,16,29,"weight"],[21,37,16,36],[22,6,16,38],[22,12,16,44,"last"],[22,16,16,48],[22,19,16,51,"weights"],[22,26,16,58],[22,27,16,59,"weights"],[22,34,16,66],[22,35,16,67,"length"],[22,41,16,73],[22,44,16,74],[22,45,16,75],[22,46,16,76],[22,47,16,77,"weight"],[22,53,16,84],[23,6,16,86,"weightLast"],[23,16,16,96],[23,19,16,99,"last"],[23,23,16,103],[24,6,17,4,"weightTrend"],[24,17,17,15],[24,20,17,18],[24,21,17,19,"last"],[24,25,17,23],[24,28,17,24,"first"],[24,33,17,29],[24,37,17,31,"Math"],[24,41,17,35],[24,42,17,36,"max"],[24,45,17,39],[24,46,17,40],[24,47,17,41],[24,49,17,43,"weights"],[24,56,17,50],[24,57,17,51,"length"],[24,63,17,57],[24,66,17,58],[24,67,17,59],[24,68,17,60],[25,4,18,2],[26,4,19,2],[27,4,20,2],[27,10,20,8,"week"],[27,14,20,12],[27,17,20,15],[27,21,20,15,"getWeekRange"],[27,41,20,27],[27,43,20,28],[27,47,20,32,"Date"],[27,51,20,36],[27,52,20,37],[27,53,20,38],[27,54,20,39],[28,4,21,2],[28,10,21,8,"evt"],[28,13,21,11],[28,16,21,14],[28,20,21,14,"getCurrentWeeklyEvent"],[28,49,21,35],[28,51,21,36,"week"],[28,55,21,40],[28,56,21,41,"start"],[28,61,21,46],[28,62,21,47],[29,4,22,2],[29,10,22,8],[30,6,22,10,"percent"],[31,4,22,18],[31,5,22,19],[31,8,22,22],[31,12,22,22,"computeEventProgress"],[31,40,22,42],[31,42,22,43,"week"],[31,46,22,47],[31,47,22,48,"dayKeys"],[31,54,22,55],[31,56,22,57,"state"],[31,61,22,62],[31,63,22,71,"evt"],[31,66,22,74],[31,67,22,75],[32,4,24,2],[32,11,24,9],[33,6,25,4,"lang"],[33,10,25,8],[33,12,25,10,"state"],[33,17,25,15],[33,18,25,16,"language"],[33,26,25,24],[34,6,26,4,"water_avg14"],[34,17,26,15],[34,19,26,17,"Number"],[34,25,26,23],[34,26,26,24,"waterAvg"],[34,34,26,32],[34,35,26,33,"toFixed"],[34,42,26,40],[34,43,26,41],[34,44,26,42],[34,45,26,43],[34,46,26,44],[35,6,27,4,"coffee_avg14"],[35,18,27,16],[35,20,27,18,"Number"],[35,26,27,24],[35,27,27,25,"coffeeAvg"],[35,36,27,34],[35,37,27,35,"toFixed"],[35,44,27,42],[35,45,27,43],[35,46,27,44],[35,47,27,45],[35,48,27,46],[36,6,28,4,"pill_adherence7"],[36,21,28,19],[36,23,28,21,"Number"],[36,29,28,27],[36,30,28,28],[36,31,28,29,"pillAdh"],[36,38,28,36],[36,41,28,37],[36,44,28,40],[36,46,28,42,"toFixed"],[36,53,28,49],[36,54,28,50],[36,55,28,51],[36,56,28,52],[36,57,28,53],[37,6,29,4,"weight_last"],[37,17,29,15],[37,19,29,17],[37,26,29,24,"weightLast"],[37,36,29,34],[37,41,29,37],[37,49,29,45],[37,52,29,47,"Number"],[37,58,29,53],[37,59,29,54,"weightLast"],[37,69,29,64],[37,70,29,65,"toFixed"],[37,77,29,72],[37,78,29,73],[37,79,29,74],[37,80,29,75],[37,81,29,76],[37,84,29,79],[37,88,29,83],[38,6,30,4,"weight_trend_per_day"],[38,26,30,24],[38,28,30,26,"Number"],[38,34,30,32],[38,35,30,33,"weightTrend"],[38,46,30,44],[38,47,30,45,"toFixed"],[38,54,30,52],[38,55,30,53],[38,56,30,54],[38,57,30,55],[38,58,30,56],[39,6,31,4,"weekly_event"],[39,18,31,16],[39,20,31,18],[40,8,31,20,"id"],[40,10,31,22],[40,12,31,24,"evt"],[40,15,31,27],[40,16,31,28,"id"],[40,18,31,30],[41,8,31,32,"title"],[41,13,31,37],[41,15,31,39,"evt"],[41,18,31,42],[41,19,31,43,"title"],[41,24,31,48],[41,25,31,49,"state"],[41,30,31,54],[41,31,31,55,"language"],[41,39,31,70],[41,40,31,71],[42,8,31,73,"progress"],[42,16,31,81],[42,18,31,83,"percent"],[43,6,31,91],[44,4,32,2],[44,5,32,3],[45,2,33,0],[46,0,33,1],[46,3]],"functionMap":{"names":["<global>","avg","xs.reduce$argument_0","buildCompactSummary","Object.values.sort$argument_0","last14.map$argument_0","last7.filter$argument_0","days.filter$argument_0"],"mappings":"AAA;ACG,0DC,UD,oBD;OGE;kDCC,mDD;kCEG,qBF;mCEC,sBF;+CGC,uCH;8BIC,6BJ"}},"type":"js/module"}]}